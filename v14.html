<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>World Quiz</title>
<link rel="icon" href="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f30d.png">
<style>
    :root { 
        --primary: #94a3b8; 
        --correct: #004225; /* British Racing Green */
        --wrong: #C80815;   /* Venetian Red */
        --bg-grad: linear-gradient(180deg, #18181b, #27272a);
        --card-bg: #27272a;
        --border: #3f3f46;
        --bar-bg: #3f3f46;
        /* New radioactive green color var */
        --aura-green: #48ff8c;
    }

    body {
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        background: var(--bg-grad);
        color: #e4e4e7;
        min-height: 100vh; 
        display: flex;
        flex-direction: column;
        align-items: center;
        overflow-y: auto; 
        -webkit-overflow-scrolling: touch;
        padding-bottom: 60px;
    }

    /* VIGNETTE OVERLAY */
    #vignette {
        position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
        pointer-events: none; z-index: 999;
        background: radial-gradient(circle, transparent 40%, rgba(160, 10, 10, 0.9));
        opacity: 0; transition: opacity 0.3s;
    }
    .throb { animation: throbAnim 1.2s ease-out; }
    @keyframes throbAnim {
        0% { opacity: 0; }
        15% { opacity: 1; }
        50% { opacity: 0.6; }
        80% { opacity: 0.9; }
        100% { opacity: 0; }
    }

    /* NAV BAR */
    .nav { 
        position: sticky; top: 0;
        width: 100%; max-width: 480px; 
        padding: 10px 20px; 
        display: flex; gap: 12px; 
        box-sizing: border-box; z-index: 100;
        background: rgba(24, 24, 27, 0.95);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border-bottom: 1px solid var(--border);
    }
    .nav-btn {
        flex: 1; padding: 12px; border-radius: 10px;
        background: transparent; border: 1px solid var(--border);
        color: #71717a; font-weight: 700; font-size: 0.85rem; cursor: pointer;
        transition: 0.2s;
    }
    .nav-btn.active { background: #3f3f46; color: #fff; border-color: #52525b; }

    .main-container {
        width: 100%; max-width: 460px; 
        padding: 20px 24px;
        box-sizing: border-box;
        display: flex; flex-direction: column;
    }

    /* PROGRESS BAR */
    .progress-track {
        width: 100%;
        height: 16px; 
        background: var(--bar-bg);
        border-radius: 8px;
        margin-bottom: 25px;
        position: relative;
        /* Re-enabled containment */
        overflow: hidden; 
        transform: translateZ(0);
    }
    
    .progress-fill {
        height: 100%;
        width: 0%;
        background: var(--correct);
        /* Removed explicit border-radius so it uses the track's clipping */
        transition: width 0.5s cubic-bezier(0.34, 1.56, 0.64, 1), background-color 0.2s, opacity 0.2s;
        position: relative;
        z-index: 5;
        opacity: 0; /* Default hidden */
    }
    .progress-fill.visible { opacity: 1; }

    /* Draining State - Fixed Lingering Red */
    .progress-fill.draining {
        background: var(--wrong) !important;
        width: 0% !important;
        opacity: 0; /* Fade out as it shrinks */
        transition: width 0.6s ease-out, opacity 0.6s ease-in;
    }

    /* NEW CONTAINED FUZZY AURA */
    .progress-aura {
        position: absolute;
        top: 0; bottom: 0; /* Stretch to full height of bar */
        width: 30px; /* A narrow strip centered on the tip */
        margin-left: -15px; /* Center the strip on the JS-provided 'left' coordinate */
        
        /* A horizontal gradient creating a vertical line of light */
        background: linear-gradient(to right, transparent, rgba(72, 255, 140, 0.9), transparent);
        filter: blur(5px); /* Fuzzy blur */
        
        z-index: 6; /* On top of fill */
        opacity: 0;
        pointer-events: none;
        transform-origin: center center;
        mix-blend-mode: screen; /* Makes the glow look brighter */
    }
    
    /* Aura Animation: Pulse width outwards and fade */
    .aura-shoot { animation: softPulse 0.6s ease-out forwards; }
    
    @keyframes softPulse {
        0% { opacity: 0; transform: scaleX(0.5); }
        20% { opacity: 1; transform: scaleX(1.2); } /* Quick flash to full width */
        100% { opacity: 0; transform: scaleX(3); } /* Dissipate outwards horizontally */
    }

    .progress-text {
        text-align: right; font-size: 0.75rem; color: #71717a; 
        font-weight: 700; margin-top: -22px; margin-bottom: 20px;
    }

    .view { display: none; flex-direction: column; width: 100%; align-items: center; }
    .view.active { display: flex; }
    
    .flag-icon { 
        font-size: 4.5rem; line-height: 1; text-align: center; display: block; 
        filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3)); margin: 0 auto;
    }
    
    .country-name { 
        font-size: 1.6rem; font-weight: 800; text-align: center; 
        margin: 15px 0 30px 0; line-height: 1.1; width: 100%;
        color: #fff;
    }

    .opts-container { width: 100%; display: flex; flex-direction: column; gap: 12px; }

    .opt-btn {
        position: relative; width: 100%; padding: 16px; 
        border-radius: 14px; font-size: 0.95rem; color: #e4e4e7; font-weight: 600;
        text-align: center; cursor: pointer; overflow: hidden;
        border: 1px solid var(--border);
        background: var(--card-bg);
        -webkit-tap-highlight-color: transparent;
        user-select: none;
        box-sizing: border-box;
        transition: background-color 0.1s;
    }

    @keyframes popClick {
        0% { transform: scale(1); }
        50% { transform: scale(0.92); }
        100% { transform: scale(1); }
    }
    .pop-anim { animation: popClick 0.2s ease-out forwards; }

    .opt-btn.correct { border-color: var(--correct); background: var(--correct); }
    .opt-btn.wrong { border-color: var(--wrong); background: var(--wrong); }
    .shake { animation: quickShake 0.4s ease-in-out both; }
    
    @keyframes quickShake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-4px); }
        75% { transform: translateX(4px); }
    }

    .search { 
        width: 100%; padding: 14px; margin-bottom: 15px; 
        border-radius: 10px; color: white; 
        background: var(--card-bg); border: 1px solid var(--border); 
        font-size: 0.95rem; box-sizing: border-box; outline: none;
    }
    .row { 
        display: flex; align-items: center; justify-content: space-between; 
        padding: 14px 0; border-bottom: 1px solid var(--border); width: 100%;
    }
    .row-left { display: flex; align-items: center; gap: 16px; flex: 1; }
    .row-flag { font-size: 1.8rem; min-width: 40px; text-align: center; }
    .row-country { font-weight: 600; font-size: 0.95rem; color: #e4e4e7; }
    .row-right { text-align: right; }
    .row-cap { font-size: 0.9rem; color: #a1a1aa; font-weight: 500; }

</style>
</head>
<body>

<div id="vignette"></div>

<div class="nav">
    <button class="nav-btn active" onclick="tab('quiz')">QUIZ</button>
    <button class="nav-btn" onclick="tab('study')">STUDY</button>
</div>

<div class="main-container">
    
    <div id="prog-container">
        <div class="progress-track">
            <div class="progress-fill" id="prog-bar"></div>
            <div class="progress-aura" id="prog-aura"></div>
        </div>
        <div class="progress-text" id="prog-text">0 / 197</div>
    </div>

    <div id="quiz-view" class="view active">
        <div class="flag-icon" id="q-flag">üåç</div>
        <div class="country-name" id="q-text">Loading...</div>
        <div id="opts" class="opts-container"></div>
    </div>

    <div id="study-view" class="view">
        <input type="text" id="search" class="search" placeholder="Search..." onkeyup="filter()">
        <div id="list" style="width:100%"></div>
    </div>

</div>

<script>
const d=[
{c:"Afghanistan",k:"Kabul",f:"üá¶üá´"},{c:"Albania",k:"Tirana",f:"üá¶üá±"},{c:"Algeria",k:"Algiers",f:"üá©üáø"},{c:"Andorra",k:"Andorra la Vella",f:"üá¶üá©"},{c:"Angola",k:"Luanda",f:"üá¶üá¥"},
{c:"Antigua & Barbuda",k:"Saint John's",f:"üá¶üá¨"},{c:"Argentina",k:"Buenos Aires",f:"üá¶üá∑"},{c:"Armenia",k:"Yerevan",f:"üá¶üá≤"},{c:"Australia",k:"Canberra",f:"üá¶üá∫"},{c:"Austria",k:"Vienna",f:"üá¶üáπ"},
{c:"Azerbaijan",k:"Baku",f:"üá¶üáø"},{c:"Bahamas",k:"Nassau",f:"üáßüá∏"},{c:"Bahrain",k:"Manama",f:"üáßüá≠"},{c:"Bangladesh",k:"Dhaka",f:"üáßüá©"},{c:"Barbados",k:"Bridgetown",f:"üáßüáß"},
{c:"Belarus",k:"Minsk",f:"üáßüáæ"},{c:"Belgium",k:"Brussels",f:"üáßüá™"},{c:"Belize",k:"Belmopan",f:"üáßüáø"},{c:"Benin",k:"Porto-Novo",f:"üáßüáØ"},{c:"Bhutan",k:"Thimphu",f:"üáßüáπ"},
{c:"Bolivia",k:"Sucre",f:"üáßüá¥"},{c:"Bosnia & Herzegovina",k:"Sarajevo",f:"üáßüá¶"},{c:"Botswana",k:"Gaborone",f:"üáßüáº"},{c:"Brazil",k:"Bras√≠lia",f:"üáßüá∑"},{c:"Brunei",k:"Bandar Seri Begawan",f:"üáßüá≥"},
{c:"Bulgaria",k:"Sofia",f:"üáßüá¨"},{c:"Burkina Faso",k:"Ouagadougou",f:"üáßüá´"},{c:"Burundi",k:"Gitega",f:"üáßüáÆ"},{c:"Cabo Verde",k:"Praia",f:"üá®üáª"},{c:"Cambodia",k:"Phnom Penh",f:"üá∞üá≠"},
{c:"Cameroon",k:"Yaound√©",f:"üá®üá≤"},{c:"Canada",k:"Ottawa",f:"üá®üá¶"},{c:"Central African Rep.",k:"Bangui",f:"üá®üá´"},{c:"Chad",k:"N'Djamena",f:"üáπüá©"},{c:"Chile",k:"Santiago",f:"üá®üá±"},
{c:"China",k:"Beijing",f:"üá®üá≥"},{c:"Colombia",k:"Bogot√°",f:"üá®üá¥"},{c:"Comoros",k:"Moroni",f:"üá∞üá≤"},{c:"Congo (DRC)",k:"Kinshasa",f:"üá®üá©"},{c:"Congo (Rep.)",k:"Brazzaville",f:"üá®üá¨"},
{c:"Costa Rica",k:"San Jos√©",f:"üá®üá∑"},{c:"Croatia",k:"Zagreb",f:"üá≠üá∑"},{c:"Cuba",k:"Havana",f:"üá®üá∫"},{c:"Cyprus",k:"Nicosia",f:"üá®üáæ"},{c:"Czechia",k:"Prague",f:"üá®üáø"},
{c:"Denmark",k:"Copenhagen",f:"üá©üá∞"},{c:"Djibouti",k:"Djibouti",f:"üá©üáØ"},{c:"Dominica",k:"Roseau",f:"üá©üá≤"},{c:"Dominican Rep.",k:"Santo Domingo",f:"üá©üá¥"},{c:"East Timor",k:"Dili",f:"üáπüá±"},
{c:"Ecuador",k:"Quito",f:"üá™üá®"},{c:"Egypt",k:"Cairo",f:"üá™üá¨"},{c:"El Salvador",k:"San Salvador",f:"üá∏üáª"},{c:"Equatorial Guinea",k:"Malabo",f:"üá¨üá∂"},{c:"Eritrea",k:"Asmara",f:"üá™üá∑"},
{c:"Estonia",k:"Tallinn",f:"üá™üá™"},{c:"Eswatini",k:"Mbabane",f:"üá∏üáø"},{c:"Ethiopia",k:"Addis Ababa",f:"üá™üáπ"},{c:"Fiji",k:"Suva",f:"üá´üáØ"},{c:"Finland",k:"Helsinki",f:"üá´üáÆ"},
{c:"France",k:"Paris",f:"üá´üá∑"},{c:"Gabon",k:"Libreville",f:"üá¨üá¶"},{c:"Gambia",k:"Banjul",f:"üá¨üá≤"},{c:"Georgia",k:"Tbilisi",f:"üá¨üá™"},{c:"Germany",k:"Berlin",f:"üá©üá™"},
{c:"Ghana",k:"Accra",f:"üá¨üá≠"},{c:"Greece",k:"Athens",f:"üá¨üá∑"},{c:"Grenada",k:"St. George's",f:"üá¨üá©"},{c:"Guatemala",k:"Guatemala City",f:"üá¨üáπ"},{c:"Guinea",k:"Conakry",f:"üá¨üá≥"},
{c:"Guinea-Bissau",k:"Bissau",f:"üá¨üáº"},{c:"Guyana",k:"Georgetown",f:"üá¨üáæ"},{c:"Haiti",k:"Port-au-Prince",f:"üá≠üáπ"},{c:"Honduras",k:"Tegucigalpa",f:"üá≠üá≥"},{c:"Hungary",k:"Budapest",f:"üá≠üá∫"},
{c:"Iceland",k:"Reykjav√≠k",f:"üáÆüá∏"},{c:"India",k:"New Delhi",f:"üáÆüá≥"},{c:"Indonesia",k:"Jakarta",f:"üáÆüá©"},{c:"Iran",k:"Tehran",f:"üáÆüá∑"},{c:"Iraq",k:"Baghdad",f:"üáÆüá∂"},
{c:"Ireland",k:"Dublin",f:"üáÆüá™"},{c:"Israel",k:"Jerusalem",f:"üáÆüá±"},{c:"Italy",k:"Rome",f:"üáÆüáπ"},{c:"Ivory Coast",k:"Yamoussoukro",f:"üá®üáÆ"},{c:"Jamaica",k:"Kingston",f:"üáØüá≤"},
{c:"Japan",k:"Tokyo",f:"üáØüáµ"},{c:"Jordan",k:"Amman",f:"üáØüá¥"},{c:"Kazakhstan",k:"Astana",f:"üá∞üáø"},{c:"Kenya",k:"Nairobi",f:"üá∞üá™"},{c:"Kiribati",k:"Tarawa",f:"üá∞üáÆ"},
{c:"Kosovo",k:"Pristina",f:"üáΩüá∞"},{c:"Kuwait",k:"Kuwait City",f:"üá∞üáº"},{c:"Kyrgyzstan",k:"Bishkek",f:"üá∞üá¨"},{c:"Laos",k:"Vientiane",f:"üá±üá¶"},{c:"Latvia",k:"Riga",f:"üá±üáª"},
{c:"Lebanon",k:"Beirut",f:"üá±üáß"},{c:"Lesotho",k:"Maseru",f:"üá±üá∏"},{c:"Liberia",k:"Monrovia",f:"üá±üá∑"},{c:"Libya",k:"Tripoli",f:"üá±üáæ"},{c:"Liechtenstein",k:"Vaduz",f:"üá±üáÆ"},
{c:"Lithuania",k:"Vilnius",f:"üá±üáπ"},{c:"Luxembourg",k:"Luxembourg",f:"üá±üá∫"},{c:"Madagascar",k:"Antananarivo",f:"üá≤üá¨"},{c:"Malawi",k:"Lilongwe",f:"üá≤üáº"},{c:"Malaysia",k:"Kuala Lumpur",f:"üá≤üáæ"},
{c:"Maldives",k:"Mal√©",f:"üá≤üáª"},{c:"Mali",k:"Bamako",f:"üá≤üá±"},{c:"Malta",k:"Valletta",f:"üá≤üáπ"},{c:"Marshall Islands",k:"Majuro",f:"üá≤üá≠"},{c:"Mauritania",k:"Nouakchott",f:"üá≤üá∑"},
{c:"Mauritius",k:"Port Louis",f:"üá≤üá∫"},{c:"Mexico",k:"Mexico City",f:"üá≤üáΩ"},{c:"Micronesia",k:"Palikir",f:"üá´üáØ"},{c:"Moldova",k:"Chisinau",f:"üá≤üá©"},{c:"Monaco",k:"Monaco",f:"üá≤üá®"},
{c:"Mongolia",k:"Ulaanbaatar",f:"üá≤üá≥"},{c:"Montenegro",k:"Podgorica",f:"üá≤üá™"},{c:"Morocco",k:"Rabat",f:"üá≤üá¶"},{c:"Mozambique",k:"Maputo",f:"üá≤üáø"},{c:"Myanmar",k:"Naypyidaw",f:"üá≤üá≤"},
{c:"Namibia",k:"Windhoek",f:"üá≥üá¶"},{c:"Nauru",k:"Yaren",f:"üá≥üá∑"},{c:"Nepal",k:"Kathmandu",f:"üá≥üáµ"},{c:"Netherlands",k:"Amsterdam",f:"üá≥üá±"},{c:"New Zealand",k:"Wellington",f:"üá≥üáø"},
{c:"Nicaragua",k:"Managua",f:"üá≥üáÆ"},{c:"Niger",k:"Niamey",f:"üá≥üá™"},{c:"Nigeria",k:"Abuja",f:"üá≥üá¨"},{c:"North Korea",k:"Pyongyang",f:"üá∞üáµ"},{c:"North Macedonia",k:"Skopje",f:"üá≤üá∞"},
{c:"Norway",k:"Oslo",f:"üá≥üá¥"},{c:"Oman",k:"Muscat",f:"üá¥üá≤"},{c:"Pakistan",k:"Islamabad",f:"üáµüá∞"},{c:"Palau",k:"Ngerulmud",f:"üáµüáº"},{c:"Palestine",k:"Ramallah",f:"üáµüá∏"},
{c:"Panama",k:"Panama City",f:"üáµüá¶"},{c:"Papua New Guinea",k:"Port Moresby",f:"üáµüá¨"},{c:"Paraguay",k:"Asunci√≥n",f:"üáµüáæ"},{c:"Peru",k:"Lima",f:"üáµüá™"},{c:"Philippines",k:"Manila",f:"üáµüá≠"},
{c:"Poland",k:"Warsaw",f:"üáµüá±"},{c:"Portugal",k:"Lisbon",f:"üáµüáπ"},{c:"Qatar",k:"Doha",f:"üá∂üá¶"},{c:"Romania",k:"Bucharest",f:"üá∑üá¥"},{c:"Russia",k:"Moscow",f:"üá∑üá∫"},
{c:"Rwanda",k:"Kigali",f:"üá∑üáº"},{c:"St. Kitts & Nevis",k:"Basseterre",f:"üá∞üá≥"},{c:"St. Lucia",k:"Castries",f:"üá±üá®"},{c:"St. Vincent",k:"Kingstown",f:"üáªüá®"},{c:"Samoa",k:"Apia",f:"üáºüá∏"},
{c:"San Marino",k:"San Marino",f:"üá∏üá≤"},{c:"Sao Tome & Principe",k:"Sao Tome",f:"üá∏üáπ"},{c:"Saudi Arabia",k:"Riyadh",f:"üá∏üá¶"},{c:"Senegal",k:"Dakar",f:"üá∏üá≥"},{c:"Serbia",k:"Belgrade",f:"üá∑üá∏"},
{c:"Seychelles",k:"Victoria",f:"üá∏üá®"},{c:"Sierra Leone",k:"Freetown",f:"üá∏üá±"},{c:"Singapore",k:"Singapore",f:"üá∏üá¨"},{c:"Slovakia",k:"Bratislava",f:"üá∏üá∞"},{c:"Slovenia",k:"Ljubljana",f:"üá∏üáÆ"},
{c:"Solomon Islands",k:"Honiara",f:"üá∏üáß"},{c:"Somalia",k:"Mogadishu",f:"üá∏üá¥"},{c:"South Africa",k:"Pretoria",f:"üáøüá¶"},{c:"South Korea",k:"Seoul",f:"üá∞üá∑"},{c:"South Sudan",k:"Juba",f:"üá∏üá∏"},
{c:"Spain",k:"Madrid",f:"üá™üá∏"},{c:"Sri Lanka",k:"Colombo",f:"üá±üá∞"},{c:"Sudan",k:"Khartoum",f:"üá∏üá©"},{c:"Suriname",k:"Paramaribo",f:"üá∏üá∑"},{c:"Sweden",k:"Stockholm",f:"üá∏üá™"},
{c:"Switzerland",k:"Bern",f:"üá®üá≠"},{c:"Syria",k:"Damascus",f:"üá∏üáæ"},{c:"Taiwan",k:"Taipei",f:"üáπüáº"},{c:"Tajikistan",k:"Dushanbe",f:"üáπüáØ"},{c:"Tanzania",k:"Dodoma",f:"üáπüáø"},
{c:"Thailand",k:"Bangkok",f:"üáπüá≠"},{c:"Togo",k:"Lom√©",f:"üáπüá¨"},{c:"Tonga",k:"Nuku ªalofa",f:"üáπüá¥"},{c:"Trinidad & Tobago",k:"Port of Spain",f:"üáπüáπ"},{c:"Tunisia",k:"Tunis",f:"üáπüá≥"},
{c:"T√ºrkiye",k:"Ankara",f:"üáπüá∑"},{c:"Turkmenistan",k:"Ashgabat",f:"üáπüá≤"},{c:"Tuvalu",k:"Funafuti",f:"üáπüáª"},{c:"Uganda",k:"Kampala",f:"üá∫üá¨"},{c:"Ukraine",k:"Kyiv",f:"üá∫üá¶"},
{c:"UAE",k:"Abu Dhabi",f:"üá¶üá™"},{c:"United Kingdom",k:"London",f:"üá¨üáß"},{c:"United States",k:"Washington, D.C.",f:"üá∫üá∏"},{c:"Uruguay",k:"Montevideo",f:"üá∫üáæ"},{c:"Uzbekistan",k:"Tashkent",f:"üá∫üáø"},
{c:"Vanuatu",k:"Port Vila",f:"üáªüá∫"},{c:"Vatican City",k:"Vatican City",f:"üáªüá¶"},{c:"Venezuela",k:"Caracas",f:"üáªüá™"},{c:"Vietnam",k:"Hanoi",f:"üáªüá≥"},{c:"Yemen",k:"Sana'a",f:"üáæüá™"},
{c:"Zambia",k:"Lusaka",f:"üáøüá≤"},{c:"Zimbabwe",k:"Harare",f:"üáøüáº"}
];

let pool = []; 
let streak = 0;
let cur = {};
let lock = false;

function resetDeck() { pool = [...d]; }
resetDeck();

function tab(t) {
    document.querySelectorAll('.view').forEach(e=>e.classList.remove('active'));
    document.querySelectorAll('.nav-btn').forEach(e=>e.classList.remove('active'));
    document.getElementById(t+'-view').classList.add('active');
    document.querySelector(`button[onclick="tab('${t}')"]`).classList.add('active');
    
    document.getElementById('prog-container').style.display = (t==='quiz') ? 'block' : 'none';
    
    if(t==='study') renderList();
}

function loadQ() {
    try {
        lock=false;
        const con = document.getElementById('opts');
        con.innerHTML='';
        
        document.getElementById('prog-bar').classList.remove('draining', 'pulse-active');
        
        if(pool.length === 0) resetDeck();
        const idx = Math.floor(Math.random() * pool.length);
        const q = pool[idx];
        pool.splice(idx, 1);
        
        cur = q;
        document.getElementById('q-text').innerText = q.c;
        document.getElementById('q-flag').innerText = q.f;

        let opts = d.filter(x=>x.k!==q.k).sort(()=>Math.random()-0.5).slice(0,3);
        opts.push(q);
        opts.sort(()=>Math.random()-0.5);

        opts.forEach(o=>{
            let b = document.createElement('div');
            b.className = 'opt-btn';
            b.innerText = o.k;
            b.onclick = ()=>check(b, o.k);
            con.appendChild(b);
        });
        
    } catch(e) { alert("Data Load Error"); }
}

function check(btn, ans) {
    if(lock) return;
    lock = true;
    
    btn.classList.add('pop-anim');
    
    if(ans === cur.k) {
        // CORRECT
        btn.classList.add('correct');
        streak++;
        if(navigator.vibrate) navigator.vibrate(10);
        
        // SYNCED DELAY
        setTimeout(() => {
            updateBar(true); 
        }, 250);

        setTimeout(loadQ, 600);
    } else {
        // WRONG
        btn.classList.add('wrong', 'shake');
        
        if(streak > 10) {
            document.getElementById('vignette').style.opacity = '1';
            document.getElementById('vignette').classList.add('throb');
            setTimeout(()=>{
                 document.getElementById('vignette').style.opacity = '0';
                 document.getElementById('vignette').classList.remove('throb');
            }, 1200);
        }

        if(navigator.vibrate) navigator.vibrate([40,40]);
        
        document.querySelectorAll('.opt-btn').forEach(b=>{
            if(b.innerText === cur.k) b.classList.add('correct');
        });
        
        // SYNCED DELAY
        setTimeout(() => {
            streak=0;
            resetDeck();
            const bar = document.getElementById('prog-bar');
            bar.classList.add('draining');
            updateBar(false);
        }, 250);
        
        setTimeout(loadQ, 800);
    }
}

function updateBar(fireAura) {
    const pct = (streak / 197) * 100;
    const bar = document.getElementById('prog-bar');
    const aura = document.getElementById('prog-aura');
    
    document.getElementById('prog-text').innerText = streak + ' / 197';

    if(streak === 0) {
        // ZERO STATE HARD RESET
        bar.style.width = '0%';
        bar.classList.remove('visible');
        // Ensure aura is killed instantly so no green shows at 0
        aura.classList.remove('aura-shoot');
        aura.style.opacity = '0'; 
    } else if(!bar.classList.contains('draining')) {
        bar.style.width = pct + '%';
        bar.classList.add('visible'); // Turns opacity to 1
        
        // Positioning Aura to the tip
        if(fireAura) {
            aura.style.left = pct + '%';
            aura.classList.remove('aura-shoot');
            void aura.offsetWidth; 
            aura.classList.add('aura-shoot');
        }
    }
}

let listDone = false;
function renderList() {
    if(listDone) return;
    const l = document.getElementById('list');
    l.innerHTML='';
    [...d].sort((a,b)=>a.c.localeCompare(b.c)).forEach(i=>{
        let r = document.createElement('div');
        r.className='row';
        r.innerHTML = `
            <div class="row-left">
                <span class="row-flag">${i.f}</span>
                <span class="row-country">${i.c}</span>
            </div>
            <div class="row-right">
                <span class="row-cap">${i.k}</span>
            </div>
        `;
        l.appendChild(r);
    });
    listDone=true;
}

function filter() {
    let v = document.getElementById('search').value.toLowerCase();
    document.querySelectorAll('.row').forEach(r=>{
        r.style.display = r.innerText.toLowerCase().includes(v) ? 'flex' : 'none';
    });
}

window.onload=function() {
    loadQ();
    updateBar(false);
};
</script>
</body>
</html>